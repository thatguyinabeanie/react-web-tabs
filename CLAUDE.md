# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

react-web-tabs is a modular and accessible React tabs component library following WAI-ARIA Authoring Practices 1.1. The library is published to GitHub Packages (`@thatguyinabeanie/react-web-tabs`).

## Commands

### Build & Development
```bash
npm run build           # Full build: types, ES, CommonJS, UMD, and styles
npm run clean           # Remove all build artifacts
npm run tsc             # Type-check without emitting files
```

### Testing
```bash
npm test                # Run all tests
npm run test:watch      # Run tests in watch mode
npm run test:coverage   # Run tests with coverage report
```

### Linting
```bash
npm run lint            # Lint all files with ESLint (must have 0 warnings)
```

### Documentation (Nextra)
```bash
npm run docs:dev        # Start Next.js dev server for documentation
npm run docs:build      # Build static documentation site
```

### Publishing
```bash
npm run prepublishOnly  # Runs clean, lint, test, and build (automatically before publish)
```

## Architecture

### Core Components

The library uses a **Context-based state management** pattern:

- **TabProvider** (`TabProvider.tsx`): Root component that creates and provides `TabSelection` instance via Context
- **TabSelection** (`TabSelection.ts`): Core state management class that handles:
  - Tab registration/unregistration
  - Active tab selection
  - Keyboard navigation (arrow keys, HOME, END)
  - Observer pattern for component updates (subscribe/unsubscribe)
  - Vertical/horizontal orientation
  - Collapsible behavior
  - onChange callbacks

- **withTabSelection** (`withTabSelection.tsx`): HOC that injects `TabSelection` from Context into components

### Component Hierarchy

```
Tabs (convenience wrapper: TabProvider + children)
└── TabProvider (provides TabSelection context)
    ├── TabList (container for Tab components)
    │   └── Tab (interactive tab button)
    │       └── TabComponent (presentational)
    └── TabPanel (content area)
        └── TabPanelComponent (presentational)
```

### Key Patterns

1. **Smart/Presentational Split**: Each component has a stateful wrapper (e.g., `Tab.tsx`) and a presentational component (e.g., `TabComponent.tsx`)

2. **Observer Pattern**: Components subscribe to `TabSelection` updates and call `forceUpdate()` when state changes

3. **Registration System**: Tabs register/unregister with `TabSelection` in constructor/componentWillUnmount

4. **Keyboard Navigation**: Tab component handles arrow keys, HOME, END per WAI-ARIA guidelines with vertical/horizontal orientation support

## Build System

### Multiple Output Formats
- **ES Modules** (`es/`): Modern bundlers, tree-shakeable
- **CommonJS** (`lib/`): Node.js compatibility
- **UMD** (`dist/`): Browser `<script>` tags, both dev and minified versions
- **TypeScript declarations** (`*.d.ts` and `*.d.ts.map`): Generated by tsc, copied to `es/` and `lib/`

### Babel Configuration
- Uses `.babelrc.library.json` for library builds (ignores `app/` and `content/` directories)
- Includes React Compiler plugin targeting React 19
- Special module resolution for `react-compiler-runtime`

### Webpack Configuration
- UMD builds via `webpack.config.babel.js`
- Externalizes React, ReactDOM, and react-compiler-runtime as peer dependencies
- Supports both development and minified production builds

## Documentation Site

Uses **Nextra** (Next.js + MDX) with:
- Content in `content/` directory (MDX files)
- App router in `app/` directory
- Static export mode (`output: 'export'`)
- Base path: `/react-web-tabs` (for GitHub Pages)
- **Note**: The docs site configuration includes redirects which don't work with static export mode (known Next.js limitation)

## React Compiler

This project uses the React Compiler (babel-plugin-react-compiler) targeting React 19. The compiler is integrated in:
- Babel configuration (all environments)
- ESLint configuration (react-compiler/react-compiler rule)

## Important Dependencies

- **react-compiler-runtime**: Required dependency that must be installed alongside the library
- Jest configuration includes module name mapping for `react/compiler-runtime` → `react-compiler-runtime`
- Webpack aliases the compiler runtime for proper resolution

## Linting & Formatting

- ESLint v9 with flat config (`eslint.config.mjs`)
- TypeScript parser and plugin
- React Compiler linting enforced
- Ignores: `dist/`, `es/`, `lib/`, `coverage/`, `dist-tsc/`, `app/`
- lint-staged runs on pre-commit via husky

## Testing

- Jest with jsdom environment
- Testing Library (React + user-event)
- Tests are in `src/__tests__/` directory
- Coverage reports in `lcov` and `text` formats
